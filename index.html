<!DOCTYPE html>
<html>
  <head>
    <title>textorizer-js</title>
    <link rel="stylesheet" href="/style.css"/>
		<link type="text/css" href="css/ui-lightness/jquery-ui-1.8rc3.custom.css" rel="stylesheet" />	
		<script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.8rc3.custom.min.js"></script>

		<script type="text/javascript" src="textorizer.js"></script>
    <script type="text/javascript"> 

      var defaults = {
        "t1_original_image_url":"http://lapin-bleu.net/images/exit-621x377.png",
        "t1_opacity":30,
        "t1_nb_strings":1000,
        "t1_threshold":100,
        "t1_font_size_min":10,
        "t1_font_size_max":30,
        "t1_output_height":200,

        "t2_original_image_url":"http://farm1.static.flickr.com/4/4463635_d3f29bae3b_o.jpg",
        "t2_opacity":30,
        "t2_text_size":12,
        "t2_line_height":1,
        "t2_saturation":0,
        "t2_kerning":0,
        "t2_font_scale":1.5,
        "t2_output_height":200
      };

      $(function() {


        var sourceCanvas = document.getElementById("original_image_canvas");
        var sourceCanvasCtx = sourceCanvas.getContext('2d');

        function resizeOutputCanvasHeightTo(height) {
          var ar = sourceCanvas.height/sourceCanvas.width;
          document.getElementById("output_canvas").height=height;
          document.getElementById("output_canvas").width=height*ar;
        }

        $("#tabs").tabs();

        $("#t1_original_image_url").val(defaults["t1_original_image_url"]);
        $("#t1_original_image").attr("src",defaults["t1_original_image_url"]);

        $("#t1_opacity").slider({min:0, 
                                 max:255, 
                                 value:defaults["t1_opacity"],
                                 slide: function(event, ui) {
                                   $("#t1_opacity_value").text(ui.value);
                                 }});
        $("#t1_opacity_value").text(defaults["t1_opacity"]);
        $("#t1_nb_strings").slider({min:100, 
                                    max:100000, 
                                    value:defaults["t1_nb_strings"],
                                    slide: function(event, ui) {
                                      $("#t1_nb_strings_value").text(ui.value);
                                    }});
        $("#t1_nb_strings_value").text(defaults["t1_nb_strings"]);
        $("#t1_threshold").slider({min:0, 
                                   max:200,
                                   step:.1,
                                   value:defaults["t1_threshold"],
                                   slide: function(event, ui) {
                                     $("#t1_threshold_value").text(ui.value);
                                   }});
        $("#t1_threshold_value").text(defaults["t1_threshold"]);
        $("#t1_font_size").slider({range: true,
                                   min: 0,
                                   max: 50,
                                   step: .1,
                                   values: [defaults["t1_font_size_min"], defaults["t1_font_size_max"]],
                                   slide: function(event, ui) {
                                     $("#t1_font_size_value_min").text(ui.values[0]);
                                     $("#t1_font_size_value_max").text(ui.values[1]);
                                   }});
        $("#t1_font_size_value_min").text($("#t1_font_size").slider("values", 0));
        $("#t1_font_size_value_max").text($("#t1_font_size").slider("values", 1));

        $("#t1_output_height").slider({min:100, 
                                       max:2000, 
                                       value:defaults["t1_output_height"],
                                       slide: function(event, ui) {
                                         $("#t1_output_height_value").text(ui.value);
                                         // update t2's size slider, too
                                         $("#t2_output_height_value").text(ui.value);
                                         $("#t2_output_height").slider("value",ui.value);
                                         resizeOutputCanvasHeightTo(ui.value);
                                      }});
        $("#t1_output_height_value").text(defaults["t1_output_height"]);

        $("#t1_preview").button();
        $("#t1_textorize_png").button();
        $("#t1_textorize_svg").button();



        $("#t2_original_image_url").val(defaults["t2_original_image_url"]);
        $("#t2_original_image").attr("src",defaults["t2_original_image_url"]);
        $("#t2_opacity").slider({min:0, 
                                 max:255, 
                                 value:defaults["t2_opacity"],
                                 slide: function(event, ui) {
                                   $("#t2_opacity_value").text(ui.value);
                                 }});
        $("#t2_opacity_value").text(defaults["t2_opacity"]);

        $("#t2_text_size").slider({min:4, 
                                   max:50, 
                                   step: .1,
                                   value:defaults["t2_text_size"],
                                   slide: function(event, ui) {
                                     $("#t2_text_size_value").text(ui.value);
                                   }});
        $("#t2_text_size_value").text(defaults["t2_text_size"]);

        $("#t2_line_height").slider({min:0.5, 
                                     max:3,
                                     step: .05,
                                     value:defaults["t2_line_height"],
                                     slide: function(event, ui) {
                                       $("#t2_line_height_value").text(ui.value);
                                     }});
        $("#t2_line_height_value").text(defaults["t2_line_height"]);

        $("#t2_saturation").slider({min:0, 
                                    max:255,
                                    value:defaults["t2_saturation"],
                                    slide: function(event, ui) {
                                      $("#t2_saturation_value").text(ui.value);
                                    }});
        $("#t2_saturation_value").text(defaults["t2_saturation"]);

        $("#t2_kerning").slider({min:-.5,
                                 max:.5,
                                 step: .05,
                                 value:defaults["t2_kerning"],
                                 slide: function(event, ui) {
                                   $("#t2_kerning_value").text(ui.value);
                                 }});
        $("#t2_kerning_value").text(defaults["t2_kerning"]);

        $("#t2_font_scale").slider({min:0, 
                                   max:5,
                                   step: .05,
                                   value:defaults["t2_font_scale"],
                                   slide: function(event, ui) {
                                     $("#t2_font_scale_value").text(ui.value);
                                   }});
        $("#t2_font_scale_value").text(defaults["t2_font_scale"]);

        $("#t2_output_height").slider({min:100, 
                                       max:2000, 
                                       value:defaults["t1_output_height"],
                                       slide: function(event, ui) {
                                         $("#t2_output_height_value").text(ui.value);
                                         // update t1's size slider, too
                                         $("#t1_output_height_value").text(ui.value);
                                         $("#t1_output_height").slider("value",ui.value);
                                         resizeOutputCanvasHeightTo(ui.value);
                                      }});
        $("#t2_output_height_value").text(defaults["t1_output_height"]);


        $("#t2_preview").button();
        $("#t2_textorize_png").button();
        $("#t2_textorize_svg").button();


        // When a new image is selected
        $("#t1_original_image_url").change(function() {
          var newURL = $(this).val();
          var t = new Image();
          t.src = newURL;

          // Display its thumbnail
          $("#t1_original_image").attr("src",newURL);

          // Put its pixels into the canvas
          sourceCanvas.width=t.width;
          sourceCanvas.height=t.height;
          sourceCanvasCtx.drawImage(t,0,0);
        });

        $("#t2_original_image_url").change(function() {
          var newURL = $(this).val();
          var t = new Image();
          t.src = newURL;

          // Display its thumbnail
          $("#t2_original_image").attr("src",newURL);

          // Put its pixels into the canvas
          sourceCanvas.width=t.width;
          sourceCanvas.height=t.height;
          sourceCanvasCtx.drawImage(t,0,0);
        });




        function t1Params() {
          return {
            sourceCanvas: sourceCanvas,
            text: $("#t1_text").val(),
            opacity: $("#t1_opacity").slider('value'),
            nbStrings: $("#t1_nb_strings").slider('value'),
            threshold: $("#t1_threshold").slider('value'),
            fontSizeMin: $("#t1_font_size").slider('values',0),
            fontSizeMax: $("#t1_font_size").slider('values',1),
            outputHeight: $("#t1_output_height").slider('value'),
            font: $('#t1_font :selected').text(),
            targetCanvas: document.getElementById('output_canvas')
          };
        }

        function t2Params() {
          return {
            sourceCanvas: sourceCanvas,
            text: $("#t2_text").val(),
            opacity: $("#t2_opacity").slider('value'),
            textSize: $("#t2_text_size").slider('value'),
            lineHeight: $("#t2_line_height").slider('value'),
            saturation: $("#t2_saturation").slider('value'),
            kerning: $("#t2_kerning").slider('value'),
            fontScale: $("#t2_font_scale").slider('value'),
            font: $('#t1_font :selected').text(),
            targetCanvas: document.getElementById('output_canvas')
          };
        }


      });
    </script> 
    <style type="text/css">
      .buttons { margin-top: 1em }
      label { display: block; margin: .5em 0 .2em -1em }
      img { border: 1px solid gray; }
      input { width: 100% }

      #main   { position: relative }
      #tabs   { width: 500px; }
      #output { position: absolute; left: 520px; top: 0; background-color: green }

    </style>
  </head>
  <body>
    <h1>Textorizer-js</h1>

    <div id="main">
    <div id="tabs">
      <ul>
        <li><a href="#tabs-textorizer1">Textorizer 1</a></li>
        <li><a href="#tabs-textorizer2">Textorizer 2</a></li>
        </ul>
        <div id="tabs-textorizer1">
          <label>Original Image URL:</label>
          <input id="t1_original_image_url" type="text"></input><br/>
          <img id="t1_original_image" height="100px"/>

          <label>Text:</label>
          <textarea id="t1_text" cols="40" rows="6"></textarea>

          <label>Opacity: <span id="t1_opacity_value">30</span></label>
          <div id="t1_opacity"></div>

          <label>Number of Strings: <span id="t1_nb_strings_value">1000</span></label>
          <div id="t1_nb_strings"></div>

          <label>Threshold: <span id="t1_threshold_value">100</span></label>
          <div id="t1_threshold"></div>

          <label>Font Sizes: <span id="t1_font_size_value_min">5</span> - <span id="t1_font_size_value_max">50</span></label>
          <div id="t1_font_size"></div>
          
          <label>Font:</label>
          <select id="t1_font">
            <option>Times New Roman</option>
            <option>Helvetica</option>
          </select>


          <label>Output Size (height): <span id="t1_output_height_value">200</span></label>
          <div id="t1_output_height"></div>

          <div class="buttons">
            <button id="t1_preview"       onclick="Textorizer1.preview(t1Params())">Preview</button>
            <button id="t1_textorize_png" onclick="Textorizer1.toPNG(t1Params())">to Image</button>
            <button id="t1_textorize_svg" onclick="Textorizer1.toSVG(t1Params())">to SVG</button>
          </div>
      </div>

      <div id="tabs-textorizer2">
        <label>Original Image URL:</label>
        <input id="t2_original_image_url" type="text"></input><br/>
        <img id="t2_original_image" height="100px"/>

        <label>Text:</label>
        <textarea id="t2_text" cols="40" rows="6"></textarea>

        <label>Opacity: <span id="t2_opacity_value">30</span></label>
        <div id="t2_opacity"></div>

        <label>Text Size: <span id="t2_text_size_value">30</span></label>
        <div id="t2_text_size"></div>

        <label>Line Height: <span id="t2_line_height_value">30</span></label>
        <div id="t2_line_height"></div>

        <label>Saturation: <span id="t2_saturation_value">30</span></label>
        <div id="t2_saturation"></div>

        <label>Kerning: <span id="t2_kerning_value">30</span></label>
        <div id="t2_kerning"></div>

        <label>Font Scale: <span id="t2_font_scale_value">30</span></label>
        <div id="t2_font_scale"></div>

        <label>Font:</label>
        <select id="t2_font">
          <option>Times New Roman</option>
          <option>Helvetica</option>
        </select>

        <label>Output Size (height): <span id="t2_output_height_value">200</span></label>
        <div id="t2_output_height"></div>

        <div class="buttons">
          <button id="t2_preview"       onclick="Textorizer2.preview(t2Params())">Preview</button>
          <button id="t2_textorize_png" onclick="Textorizer2.toPNG(t2Params())">to Image</button>
          <button id="t2_textorize_svg" onclick="Textorizer2.toSVG(t2Params())">to SVG</button>
        </div>
      </div>
    </div>

    <div id="output">
      <canvas id="output_canvas" width="100" height="100"></canvas>
    </div>
    </div>


    <canvas style="display:none" id="original_image_canvas" width="10" height="10"></canvas>

  </body>
</html>